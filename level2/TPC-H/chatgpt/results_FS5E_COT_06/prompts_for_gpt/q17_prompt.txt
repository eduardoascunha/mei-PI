
You are a SQL expert.
The examples below show reasoning patterns and SQL queries.
Follow the same step-by-step thinking approach for the new question.
Return ONLY the SQL code without markdown formatting or explanations.


DATABASE SCHEMA:
Table customer(
  c_custkey integer,
  c_name character varying,
  c_address character varying,
  c_nationkey integer,
  c_phone character,
  c_acctbal numeric,
  c_mktsegment character,  -- Possible values: 'AUTOMOBILE', 'BUILDING', 'FURNITURE', 'MACHINERY', 'HOUSEHOLD'
  c_comment character varying
)

Table lineitem(
  l_orderkey integer,
  l_partkey integer,
  l_suppkey integer,
  l_linenumber integer,
  l_quantity numeric,
  l_extendedprice numeric,
  l_discount numeric,
  l_tax numeric,
  l_returnflag character,  -- Possible values: 'R' (Return), 'A' (Accept), 'N' (No return)
  l_linestatus character,  -- Possible values: 'O' (Open), 'F' (Filled)
  l_shipdate date,
  l_commitdate date,
  l_receiptdate date,
  l_shipinstruct character,  -- Possible values: 'DELIVER IN PERSON', 'COLLECT COD', 'NONE', 'TAKE BACK RETURN'
  l_shipmode character,  -- Possible values: 'AIR REG', 'AIR', 'RAIL', 'SHIP', 'TRUCK', 'MAIL', 'FOB'
  l_comment character varying
)

Table nation(
  n_nationkey integer,
  n_name character,   -- examples: 'ALGERIA', 'BRAZIL', 'CANADA', 'JAPAN', etc.
  n_regionkey integer,
  n_comment character varying
)

Table orders(
  o_orderkey integer,
  o_custkey integer,
  o_orderstatus character,  -- Possible values: 'O' (Open), 'F' (Filled), 'P' (Partial)
  o_totalprice numeric,
  o_orderdate date,
  o_orderpriority character,  -- Possible values: '1-URGENT', '2-HIGH', '3-MEDIUM', '4-NOT SPECIFIED', '5-LOW'
  o_clerk character,
  o_shippriority integer,
  o_comment character varying
)

Table part(
  p_partkey integer,
  p_name character varying,
  p_mfgr character,  
  p_brand character,  
  p_type character varying,  
  p_size integer,
  p_container character, 
  p_retailprice numeric,
  p_comment character varying
)

Table partsupp(
  ps_partkey integer,
  ps_suppkey integer,
  ps_availqty integer,
  ps_supplycost numeric,
  ps_comment character varying
)

Table region(
  r_regionkey integer,
  r_name character,  -- Possible values: 'AFRICA', 'AMERICA', 'ASIA', 'EUROPE', 'MIDDLE EAST'
  r_comment character varying
)

Table supplier(
  s_suppkey integer,
  s_name character varying,
  s_address character varying,
  s_nationkey integer,
  s_phone character,
  s_acctbal numeric,
  s_comment character varying
)

Here are some examples of questions with chain-of-thought reasoning and their SQL queries:

--- Example 1 ---
QUESTION:
The Discounted Revenue Query reports the gross discounted revenue attributed to the sale of selected parts handled in  a  particular  manner. This  query  is  an  example  of  code  such  as  might be  produced  programmatically  by  a  data mining tool.
The  Discounted  Revenue  query  finds  the  gross  discounted  revenue  for  all  orders  for three  different  types  of  parts that  were  shipped by air  and  delivered in person. Parts are selected based on the  combination of specific brands, a list of containers, and a range of sizes.
Substitution Parameters:
1. QUANTITY1 is randomly selected within [1..10]. In this case assume QUANTITY1 = 4
2. QUANTITY2 is randomly selected within [10..20]. In this case assume QUANTITY2 = 16
3. QUANTITY3 is randomly selected within [20..30]. In this case assume QUANTITY3 = 29
4. BRAND1, BRAND2, BRAND3 = 'Brand#MN' where each MN is a two character string representing two numbers randomly and independently selected within [1 .. 5]. In this case assume BRAND1 = 'Brand#11' , BRAND2 = 'Brand#25' , BRAND3 = 'Brand#54'

CHAIN OF THOUGHT:
Let's think step by step.
According to "brand 25 brand3", columns [part.p_brand] may be used.
According to "containers and", columns [part.p_container] may be used.
According to "discounted revenue query finds", columns [lineitem.l_discount] may be used.
According to "parts are selected based", columns [part.p_partkey] may be used.
According to "quantity1 is", columns [lineitem.l_quantity] may be used.
According to "selected parts handled in", columns [lineitem.l_partkey] may be used.
According to "sizes substitution parameters 1", columns [part.p_size] may be used.
Values [10, 15, 16, 29, 4, 5, AIR, AIR REG, Brand#11, Brand#25, Brand#54, DELIVER IN PERSON, LG BOX, LG CASE, LG PACK, LG PKG, MED BAG, MED BOX, MED PACK, MED PKG, SM BOX, SM CASE, SM PACK, SM PKG] may be used.
So the final answer is:

SQL QUERY:
select
	sum(l_extendedprice* (1 - l_discount)) as revenue
from
	lineitem,
	part
where
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#11'
		and p_container in ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')
		and l_quantity >= 4 and l_quantity <= 4 + 10
		and p_size between 1 and 5
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	)
	or
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#25'
		and p_container in ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')
		and l_quantity >= 16 and l_quantity <= 16 + 10
		and p_size between 1 and 10
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	)
	or
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#54'
		and p_container in ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')
		and l_quantity >= 29 and l_quantity <= 29 + 10
		and p_size between 1 and 15
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	);

--- Example 2 ---
QUESTION:
The query identifies customers who might be having problems with the parts that are shipped to them.
The Returned Item Reporting Query finds the top 20 customers, in terms of their effect on lost revenue for a given quarter,  who  have  returned  parts.  The  query  considers  only  parts  that  were  ordered  in  the  specified  quarter.  The query lists the customer's name, address, nation, phone number, account balance, comment information and revenue lost. The customers are listed in descending order of lost revenue. Revenue lost is defined as sum(l_extendedprice*(1-l_discount)) for all qualifying lineitems.
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text:
1. DATE is the first day of a randomly selected month from the second month of 1993 to the first month of 1995. In this case assume DATE '1993-08-01'

CHAIN OF THOUGHT:
Let's think step by step.
According to "address nation", columns [nation.n_nationkey] may be used.
According to "comment information and", columns [customer.c_comment] may be used.
According to "customer s name", columns [customer.c_name, customer.c_phone] may be used.
According to "customer s name address", columns [customer.c_acctbal, customer.c_address, customer.c_custkey] may be used.
According to "l_discount for", columns [lineitem.l_discount] may be used.
According to "l_extendedprice 1", columns [lineitem.l_extendedprice] may be used.
According to "lineitems substitution", columns [lineitem.l_orderkey, lineitem.l_returnflag] may be used.
According to "name address nation", columns [customer.c_nationkey, nation.n_name] may be used.
According to "order of", columns [orders.o_custkey, orders.o_orderdate, orders.o_orderkey] may be used.
Values [1993-08-01, 3, R] may be used.
So the final answer is:

SQL QUERY:
select
	c_custkey,
	c_name,
	sum(l_extendedprice * (1 - l_discount)) as revenue,
	c_acctbal,
	n_name,
	c_address,
	c_phone,
	c_comment
from
	customer,
	orders,
	lineitem,
	nation
where
	c_custkey = o_custkey
	and l_orderkey = o_orderkey
	and o_orderdate >= date '1993-08-01'
	and o_orderdate < date '1993-08-01' + interval '3' month
	and l_returnflag = 'R'
	and c_nationkey = n_nationkey
group by
	c_custkey,
	c_name,
	c_acctbal,
	c_phone,
	n_name,
	c_address,
	c_comment
order by
	revenue desc
limit 20;

--- Example 3 ---
QUESTION:
This  query  quantifies  the  amount  of  revenue  increase  that  would  have  resulted  from  eliminating  certain  company-wide discounts in a given percentage range in a given year. Asking this type of "what if" query can be used to look for ways to increase revenues.
The Forecasting Revenue Change Query considers all the lineitems shipped in a given year with discounts between DISCOUNT-0.01  and  DISCOUNT+0.01.  The  query  lists  the  amount  by  which  the  total  revenue  would  have increased  if  these  discounts  had  been  eliminated  for  lineitems  with  l_quantity  less  than  quantity.  Note  that  the potential revenue increase is equal to the sum of [l_extendedprice * l_discount] for all lineitems with discounts and quantities in the qualifying range.
Substitution Parameters: Values for the following substitution parameters must be generated and used to build the executable query text: 
1. DATE is the first of January of a randomly selected year within [1993 .. 1997]; In this case assume DATE '1994-01-01'
2. DISCOUNT is randomly selected within [0.02 .. 0.09]; In this case assume DISCOUNT 0.02
3. QUANTITY is randomly selected within [24 .. 25]. In this case assume QUANTITY 25

CHAIN OF THOUGHT:
Let's think step by step.
According to "l_discount for all lineitems", columns [lineitem.l_discount] may be used.
According to "lineitems shipped in", columns [lineitem.l_shipdate] may be used.
According to "lineitems with l_quantity", columns [lineitem.l_quantity] may be used.
According to "of l_extendedprice", columns [lineitem.l_extendedprice] may be used.
Values [0.01, 0.02, 1, 1994-01-01, 25] may be used.
So the final answer is:

SQL QUERY:
select
	sum(l_extendedprice * l_discount) as revenue
from
	lineitem
where
	l_shipdate >= date '1994-01-01'
	and l_shipdate < date '1994-01-01' + interval '1' year
	and l_discount between 0.02 - 0.01 and 0.02 + 0.01
	and l_quantity < 25;

--- Example 4 ---
QUESTION:
This query determines the value of goods shipped between certain nations to help in the  re-negotiation of shipping 
contracts. 
The Volume  Shipping Query finds, for two given nations, the  gross discounted revenues derived from lineitems in which parts  were  shipped from a  supplier in either nation to a  customer in the  other nation during 1995 and 1996. The query lists the supplier nation, the customer nation, the year, and the revenue from shipments that took place  in that year. The query orders the answer by Supplier nation, Customer nation, and year (all ascending).
Substitution Parameters: Values for the following substitution parameters must be generated and used to build the executable query text: 
1. NATION1 is randomly selected within the list of values defined for N_NAME in Clause 4.2.3; In this case assume NATION1 'ARGENTINA'
2. NATION2 is randomly selected within the list of values defined for N_NAME in Clause 4.2.3 and must be different from the value selected for NATION1 in item 1 above. In this case assume NATION2 'KENYA'

CHAIN OF THOUGHT:
Let's think step by step.
According to "customer nation the", columns [customer.c_custkey] may be used.
According to "derived from lineitems in", columns [lineitem.l_extendedprice] may be used.
According to "from lineitems in", columns [lineitem.l_shipdate] may be used.
According to "lineitems in", columns [lineitem.l_discount, lineitem.l_orderkey, lineitem.l_suppkey] may be used.
According to "nation customer", columns [customer.c_nationkey] may be used.
According to "nation1 in", columns [nation.n_name, nation.n_nationkey] may be used.
According to "query orders", columns [orders.o_custkey, orders.o_orderkey] may be used.
According to "supplier in", columns [supplier.s_suppkey] may be used.
According to "supplier nation", columns [supplier.s_nationkey] may be used.
Values [1995-01-01, 1996-12-31, ARGENTINA, KENYA] may be used.
So the final answer is:

SQL QUERY:
select
	supp_nation,
	cust_nation,
	l_year,
	sum(volume) as revenue
from
	(
		select
			n1.n_name as supp_nation,
			n2.n_name as cust_nation,
			extract(year from l_shipdate) as l_year,
			l_extendedprice * (1 - l_discount) as volume
		from
			supplier,
			lineitem,
			orders,
			customer,
			nation n1,
			nation n2
		where
			s_suppkey = l_suppkey
			and o_orderkey = l_orderkey
			and c_custkey = o_custkey
			and s_nationkey = n1.n_nationkey
			and c_nationkey = n2.n_nationkey
			and (
				(n1.n_name = 'ARGENTINA' and n2.n_name = 'KENYA')
				or (n1.n_name = 'KENYA' and n2.n_name = 'ARGENTINA')
			)
			and l_shipdate between date '1995-01-01' and date '1996-12-31'
	) as shipping
group by
	supp_nation,
	cust_nation,
	l_year
order by
	supp_nation,
	cust_nation,
	l_year;

--- Example 5 ---
QUESTION:
This query seeks relationships between customers and the size of their orders. 
This query determines  the  distribution of customers by  the  number of orders they have  made, including customers who have no record of orders, past or present. It counts and reports how many customers have no orders, how many have 1, 2, 3, etc. A check is made to ensure that the orders counted do not fall into one of several special categories of orders. Special categories are identified in the order comment column by looking for a particular pattern. 
Substitution Parameters:
1. WORD1 is randomly selected from 4 possible values: special, pending, unusual, express. In this case assume WORD1 unusual
2. WORD2 is randomly selected from 4 possible values: packages, requests, accounts, deposits. In this case assume WORD2 accounts

CHAIN OF THOUGHT:
Let's think step by step.
According to "customers who", columns [customer.c_custkey] may be used.
According to "order comment", columns [orders.o_comment] may be used.
According to "orders how", columns [orders.o_orderkey] may be used.
According to "orders special", columns [orders.o_custkey] may be used.
Values [%unusual%accounts%] may be used.
So the final answer is:

SQL QUERY:
select
	c_count,
	count(*) as custdist
from
	(
		select
			c_custkey,
			count(o_orderkey)
		from
			customer left outer join orders on
				c_custkey = o_custkey
				and o_comment not like '%unusual%accounts%'
		group by
			c_custkey
	) as c_orders (c_custkey, c_count)
group by
	c_count
order by
	custdist desc,
	c_count desc;

--- Your Task ---
QUESTION:
This  query  determines  how  much  average  yearly  revenue  would  be  lost  if  orders  were  no longer  filled  for  small quantities of certain parts. This may reduce overhead expenses by concentrating sales on larger shipments.
The  Small-Quantity-Order  Revenue  Query  considers  parts  of  a  given  brand  and  with  a given  container  type  and determines the average lineitem quantity of such parts ordered for all orders (past and pending) in the 7 -year database. What would be the average yearly gross (undiscounted) loss in revenue if orders for these parts with a quantity of less than 20% of this average were no longer taken?
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. BRAND = 'Brand#MN' where MN is a  two character string representing two numbers randomly and independently selected within [1 .. 5]; In this case assume BRAND 'Brand#23'
2. CONTAINER  is  randomly  selected  within  the  list  of  2-syllable  strings  defined  for Containers  in  Clause 4.2.2.13. In this case assume CONTAINER 'SM CAN'

Think step by step and then return ONLY the SQL query:
