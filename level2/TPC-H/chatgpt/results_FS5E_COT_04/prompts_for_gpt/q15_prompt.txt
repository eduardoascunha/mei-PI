
You are a SQL expert.
The examples below show reasoning patterns and SQL queries.
Follow the same step-by-step thinking approach for the new question.
Return ONLY the SQL code without markdown formatting or explanations.


DATABASE SCHEMA:
Table customer(
  c_custkey integer,
  c_name character varying,
  c_address character varying,
  c_nationkey integer,
  c_phone character,
  c_acctbal numeric,
  c_mktsegment character,  -- Possible values: 'AUTOMOBILE', 'BUILDING', 'FURNITURE', 'MACHINERY', 'HOUSEHOLD'
  c_comment character varying
)

Table lineitem(
  l_orderkey integer,
  l_partkey integer,
  l_suppkey integer,
  l_linenumber integer,
  l_quantity numeric,
  l_extendedprice numeric,
  l_discount numeric,
  l_tax numeric,
  l_returnflag character,  -- Possible values: 'R' (Return), 'A' (Accept), 'N' (No return)
  l_linestatus character,  -- Possible values: 'O' (Open), 'F' (Filled)
  l_shipdate date,
  l_commitdate date,
  l_receiptdate date,
  l_shipinstruct character,  -- Possible values: 'DELIVER IN PERSON', 'COLLECT COD', 'NONE', 'TAKE BACK RETURN'
  l_shipmode character,  -- Possible values: 'AIR REG', 'AIR', 'RAIL', 'SHIP', 'TRUCK', 'MAIL', 'FOB'
  l_comment character varying
)

Table nation(
  n_nationkey integer,
  n_name character,   -- examples: 'ALGERIA', 'BRAZIL', 'CANADA', 'JAPAN', etc.
  n_regionkey integer,
  n_comment character varying
)

Table orders(
  o_orderkey integer,
  o_custkey integer,
  o_orderstatus character,  -- Possible values: 'O' (Open), 'F' (Filled), 'P' (Partial)
  o_totalprice numeric,
  o_orderdate date,
  o_orderpriority character,  -- Possible values: '1-URGENT', '2-HIGH', '3-MEDIUM', '4-NOT SPECIFIED', '5-LOW'
  o_clerk character,
  o_shippriority integer,
  o_comment character varying
)

Table part(
  p_partkey integer,
  p_name character varying,
  p_mfgr character,  
  p_brand character,  
  p_type character varying,  
  p_size integer,
  p_container character, 
  p_retailprice numeric,
  p_comment character varying
)

Table partsupp(
  ps_partkey integer,
  ps_suppkey integer,
  ps_availqty integer,
  ps_supplycost numeric,
  ps_comment character varying
)

Table region(
  r_regionkey integer,
  r_name character,  -- Possible values: 'AFRICA', 'AMERICA', 'ASIA', 'EUROPE', 'MIDDLE EAST'
  r_comment character varying
)

Table supplier(
  s_suppkey integer,
  s_name character varying,
  s_address character varying,
  s_nationkey integer,
  s_phone character,
  s_acctbal numeric,
  s_comment character varying
)

Here are some examples of questions with chain-of-thought reasoning and their SQL queries:

--- Example 1 ---
QUESTION:
This query finds which supplier should be selected to place an order for a given part in a given region.
The Minimum Cost Supplier Query finds, in a given region, for each part of a certain type and size, the supplier who can  supply  it  at  minimum  cost.  If  several  suppliers  in  that  region  offer  the  desired  part  type  and  size  at  the  same (minimum)  cost,  the  query  lists  the  parts  from  suppliers  with  the  100  highest  account  balances.  For  each  supplier, the  query  lists  the  supplier's  account  balance,  name  and  nation;  the  part's  number  and  manufacturer;  the  supplier's address, phone number and comment information.
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text:
1. SIZE is randomly selected within [1. 50]; In this case assume SIZE 2
2. TYPE is randomly selected within the list Syllable 3 defined for Types in Clause 4.2.2.13; In this case assume type '%TIN'
3. REGION is randomly selected within the list of values defined for R_NAME in 4.2.3. In this case assume REGION 'ASIA'

CHAIN OF THOUGHT:
Let's think step by step.
According to "cost supplier query finds", columns [partsupp.ps_supplycost] may be used.
According to "nation the", columns [nation.n_name, nation.n_nationkey] may be used.
According to "part in", columns [part.p_partkey, partsupp.ps_partkey] may be used.
According to "part s number", columns [part.p_mfgr, partsupp.ps_suppkey] may be used.
According to "part type", columns [part.p_type] may be used.
According to "part type and size", columns [part.p_size] may be used.
According to "region for", columns [nation.n_regionkey, region.r_name] may be used.
According to "region the", columns [region.r_regionkey] may be used.
According to "supplier s", columns [supplier.s_acctbal, supplier.s_comment, supplier.s_name, supplier.s_nationkey, supplier.s_suppkey] may be used.
According to "supplier s address", columns [supplier.s_address] may be used.
According to "supplier s address phone", columns [supplier.s_phone] may be used.
Values [%TIN, 2, ASIA] may be used.
So the final answer is:

SQL QUERY:
select
	s_acctbal,
	s_name,
	n_name,
	p_partkey,
	p_mfgr,
	s_address,
	s_phone,
	s_comment
from
	part,
	supplier,
	partsupp,
	nation,
	region
where
	p_partkey = ps_partkey
	and s_suppkey = ps_suppkey
	and p_size = 2
	and p_type like '%TIN'
	and s_nationkey = n_nationkey
	and n_regionkey = r_regionkey
	and r_name = 'ASIA'
	and ps_supplycost = (
		select
			min(ps_supplycost)
		from
			partsupp,
			supplier,
			nation,
			region
		where
			p_partkey = ps_partkey
			and s_suppkey = ps_suppkey
			and s_nationkey = n_nationkey
			and n_regionkey = r_regionkey
			and r_name = 'ASIA'
	)
order by
	s_acctbal desc,
	n_name,
	s_name,
	p_partkey
limit 100;

--- Example 2 ---
QUESTION:
This query determines how well the order priority system is working and gives an assessment of customer satisfaction.
The Order Priority Checking Query counts the number of orders ordered in a given quarter of a given year in which at least one lineitem  was received by the  customer later than its committed date. The  query lists the  count of such orders for each order priority sorted in ascending priority order.
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. DATE  is  the  first  day  of  a  randomly  selected  month  between  the  first  month  of  1993  and  the  10th  month  of 1997. In this case assume date '1997-01-01'

CHAIN OF THOUGHT:
Let's think step by step.
According to "lineitem was", columns [lineitem.l_commitdate] may be used.
According to "lineitem was received by", columns [lineitem.l_receiptdate] may be used.
According to "of orders ordered", columns [orders.o_orderdate] may be used.
According to "of orders ordered in", columns [orders.o_orderpriority] may be used.
According to "one lineitem", columns [lineitem.l_orderkey] may be used.
According to "orders ordered in a", columns [orders.o_orderkey] may be used.
Values [1997-01-01, 3] may be used.
So the final answer is:

SQL QUERY:
select
	o_orderpriority,
	count(*) as order_count
from
	orders
where
	o_orderdate >= date '1997-01-01'
	and o_orderdate < date '1997-01-01' + interval '3' month
	and exists (
		select
			*
		from
			lineitem
		where
			l_orderkey = o_orderkey
			and l_commitdate < l_receiptdate
	)
group by
	o_orderpriority
order by
	o_orderpriority;

--- Example 3 ---
QUESTION:
This query monitors the market response to a promotion such as TV advertisements or a special campaign.
The Promotion Effect Query determines what percentage of the revenue in a given year and month was derived from promotional parts. The query considers only parts actually shipped in that month and gives the percentage. Revenue is defined as (l_extendedprice * (1-l_discount)). 
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. DATE is the first day of a month randomly selected from a random year within [1993 .. 1997]. In this case assume DATE '1996-04-01'

CHAIN OF THOUGHT:
Let's think step by step.
According to "as l_extendedprice", columns [lineitem.l_extendedprice] may be used.
According to "l_extendedprice 1 l_discount", columns [lineitem.l_discount] may be used.
According to "parts the", columns [part.p_partkey, part.p_type] may be used.
According to "shipped in that month", columns [lineitem.l_shipdate] may be used.
Values [1, 100.00, 1996-04-01, PROMO%] may be used.
So the final answer is:

SQL QUERY:
select
	100.00 * sum(case
		when p_type like 'PROMO%'
			then l_extendedprice * (1 - l_discount)
		else 0
	end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue
from
	lineitem,
	part
where
	l_partkey = p_partkey
	and l_shipdate >= date '1996-04-01'
	and l_shipdate < date '1996-04-01' + interval '1' month;

--- Example 4 ---
QUESTION:
The  Large  Volume  Customer  Query  ranks  customers  based  on  their  having  placed  a  large  quantity  order.  Large quantity orders are defined as those orders whose total quantity is above a certain level.
The Large Volume Customer Query finds a list of the top 100 customers who have ever placed large quantity orders. The query lists the customer name, customer key, the order key, date and total price and the quantity for the order. 
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. QUANTITY is randomly selected within [312..315]. In this case assume QUANTITY = 314

CHAIN OF THOUGHT:
Let's think step by step.
According to "customer key the", columns [customer.c_custkey] may be used.
According to "customer name customer", columns [customer.c_name] may be used.
According to "key the order key", columns [lineitem.l_orderkey] may be used.
According to "order key", columns [orders.o_custkey, orders.o_orderkey] may be used.
According to "order key date", columns [orders.o_orderdate] may be used.
According to "orders whose total", columns [orders.o_totalprice] may be used.
According to "text 1 quantity is", columns [lineitem.l_quantity] may be used.
Values [314] may be used.
So the final answer is:

SQL QUERY:
select
	c_name,
	c_custkey,
	o_orderkey,
	o_orderdate,
	o_totalprice,
	sum(l_quantity)
from
	customer,
	orders,
	lineitem
where
	o_orderkey in (
		select
			l_orderkey
		from
			lineitem
		group by
			l_orderkey having
				sum(l_quantity) > 314
	)
	and c_custkey = o_custkey
	and o_orderkey = l_orderkey
group by
	c_name,
	c_custkey,
	o_orderkey,
	o_orderdate,
	o_totalprice
order by
	o_totalprice desc,
	o_orderdate
limit 100;

--- Example 5 ---
QUESTION:
This query reports the amount of business that was billed, shipped, and returned. 
The Pricing Summary Report Query provides a summary pricing report for all lineitems shipped as of a given date. The  date  is  within  60  -  120  days  of  the  greatest  ship  date  contained  in  the  database.  The  query  lists  totals  for extended  price,  discounted  extended  price,  discounted  extended  price  plus  tax,  average  quantity,  average  extended price,  and  average  discount.  These  aggregates  are  grouped  by  RETURNFLAG  and  LINESTATUS,  and  listed  in  ascending  order  of  RETURNFLAG  and  LINESTATUS.  A  count  of  the  number  of  lineitems  in  each  group  is included. 
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text:  
1. DELTA is randomly selected within [60. 120]. In this case assume DELTA = '84 days'
Comment: 1998-12-01 is the highest possible ship date as defined in the database population. (This is ENDDATE - 30).  The  query  will  include  all  lineitems  shipped  before  this  date  minus  DELTA  days.  The  intent  is  to  choose DELTA so that between 95% and 97% of the rows in the table are scanned.

CHAIN OF THOUGHT:
Let's think step by step.
According to "lineitems in", columns [lineitem.l_discount] may be used.
According to "lineitems shipped before", columns [lineitem.l_shipdate] may be used.
According to "linestatus and", columns [lineitem.l_linestatus] may be used.
According to "number of lineitems", columns [lineitem.l_quantity] may be used.
According to "of lineitems", columns [lineitem.l_tax] may be used.
According to "price discounted extended price", columns [lineitem.l_extendedprice] may be used.
According to "returnflag and linestatus a", columns [lineitem.l_returnflag] may be used.
Values [1998-12-01, 84 days] may be used.
So the final answer is:

SQL QUERY:
select
	l_returnflag,
	l_linestatus,
	sum(l_quantity) as sum_qty,
	sum(l_extendedprice) as sum_base_price,
	sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,
	sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,
	avg(l_quantity) as avg_qty,
	avg(l_extendedprice) as avg_price,
	avg(l_discount) as avg_disc,
	count(*) as count_order
from
	lineitem
where
	l_shipdate <= date '1998-12-01' - interval '84 days'
group by
	l_returnflag,
	l_linestatus
order by
	l_returnflag,
	l_linestatus;

--- Your Task ---
QUESTION:
This query determines the top supplier so it can be rewarded, given more business, or identified for special recognition.
The Top Supplier Query finds the supplier who contributed the most to the overall revenue for parts shipped during a  given  quarter  of  a  given  year.  In  case  of  a  tie,  the  query lists  all  suppliers  whose  contribution  was  equal  to  the maximum, presented in supplier number order. 
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. DATE  is  the  first  day  of  a  randomly  selected  month  between  the  first  month  of  1993  and  the 10th  month of 1997. In this case assume DATE '1997-01-01'

Think step by step and then return ONLY the SQL query:
