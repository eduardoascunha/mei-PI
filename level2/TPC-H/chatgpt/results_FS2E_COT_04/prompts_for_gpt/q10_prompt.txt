
You are a SQL expert.
The examples below show reasoning patterns and SQL queries.
Follow the same step-by-step thinking approach for the new question.
Return ONLY the SQL code without markdown formatting or explanations.


DATABASE SCHEMA:
Table customer(
  c_custkey integer,
  c_name character varying,
  c_address character varying,
  c_nationkey integer,
  c_phone character,
  c_acctbal numeric,
  c_mktsegment character,  -- Possible values: 'AUTOMOBILE', 'BUILDING', 'FURNITURE', 'MACHINERY', 'HOUSEHOLD'
  c_comment character varying
)

Table lineitem(
  l_orderkey integer,
  l_partkey integer,
  l_suppkey integer,
  l_linenumber integer,
  l_quantity numeric,
  l_extendedprice numeric,
  l_discount numeric,
  l_tax numeric,
  l_returnflag character,  -- Possible values: 'R' (Return), 'A' (Accept), 'N' (No return)
  l_linestatus character,  -- Possible values: 'O' (Open), 'F' (Filled)
  l_shipdate date,
  l_commitdate date,
  l_receiptdate date,
  l_shipinstruct character,  -- Possible values: 'DELIVER IN PERSON', 'COLLECT COD', 'NONE', 'TAKE BACK RETURN'
  l_shipmode character,  -- Possible values: 'AIR REG', 'AIR', 'RAIL', 'SHIP', 'TRUCK', 'MAIL', 'FOB'
  l_comment character varying
)

Table nation(
  n_nationkey integer,
  n_name character,   -- examples: 'ALGERIA', 'BRAZIL', 'CANADA', 'JAPAN', etc.
  n_regionkey integer,
  n_comment character varying
)

Table orders(
  o_orderkey integer,
  o_custkey integer,
  o_orderstatus character,  -- Possible values: 'O' (Open), 'F' (Filled), 'P' (Partial)
  o_totalprice numeric,
  o_orderdate date,
  o_orderpriority character,  -- Possible values: '1-URGENT', '2-HIGH', '3-MEDIUM', '4-NOT SPECIFIED', '5-LOW'
  o_clerk character,
  o_shippriority integer,
  o_comment character varying
)

Table part(
  p_partkey integer,
  p_name character varying,
  p_mfgr character,  
  p_brand character,  
  p_type character varying,  
  p_size integer,
  p_container character, 
  p_retailprice numeric,
  p_comment character varying
)

Table partsupp(
  ps_partkey integer,
  ps_suppkey integer,
  ps_availqty integer,
  ps_supplycost numeric,
  ps_comment character varying
)

Table region(
  r_regionkey integer,
  r_name character,  -- Possible values: 'AFRICA', 'AMERICA', 'ASIA', 'EUROPE', 'MIDDLE EAST'
  r_comment character varying
)

Table supplier(
  s_suppkey integer,
  s_name character varying,
  s_address character varying,
  s_nationkey integer,
  s_phone character,
  s_acctbal numeric,
  s_comment character varying
)

Here are some examples of questions with chain-of-thought reasoning and their SQL queries:

--- Example 1 ---
QUESTION:
This  query  determines  how  much  average  yearly  revenue  would  be  lost  if  orders  were  no longer  filled  for  small quantities of certain parts. This may reduce overhead expenses by concentrating sales on larger shipments.
The  Small-Quantity-Order  Revenue  Query  considers  parts  of  a  given  brand  and  with  a given  container  type  and determines the average lineitem quantity of such parts ordered for all orders (past and pending) in the 7 -year database. What would be the average yearly gross (undiscounted) loss in revenue if orders for these parts with a quantity of less than 20% of this average were no longer taken?
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. BRAND = 'Brand#MN' where MN is a  two character string representing two numbers randomly and independently selected within [1 .. 5]; In this case assume BRAND 'Brand#23'
2. CONTAINER  is  randomly  selected  within  the  list  of  2-syllable  strings  defined  for Containers  in  Clause 4.2.2.13. In this case assume CONTAINER 'SM CAN'

CHAIN OF THOUGHT:
Let's think step by step.
According to "given container type", columns [part.p_container] may be used.
According to "lineitem quantity", columns [lineitem.l_extendedprice, lineitem.l_quantity] may be used.
According to "lineitem quantity of", columns [lineitem.l_partkey] may be used.
According to "parts with", columns [part.p_brand, part.p_partkey] may be used.
Values [0.2, 7.0, Brand#23, SM CAN] may be used.
So the final answer is:

SQL QUERY:
select
	sum(l_extendedprice) / 7.0 as avg_yearly
from
	lineitem,
	part
where
	p_partkey = l_partkey
	and p_brand = 'Brand#23'
	and p_container = 'SM CAN'
	and l_quantity < (
		select
			0.2 * avg(l_quantity)
		from
			lineitem
		where
			l_partkey = p_partkey
	);

--- Example 2 ---
QUESTION:
This query determines the top supplier so it can be rewarded, given more business, or identified for special recognition.
The Top Supplier Query finds the supplier who contributed the most to the overall revenue for parts shipped during a  given  quarter  of  a  given  year.  In  case  of  a  tie,  the  query lists  all  suppliers  whose  contribution  was  equal  to  the maximum, presented in supplier number order. 
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. DATE  is  the  first  day  of  a  randomly  selected  month  between  the  first  month  of  1993  and  the 10th  month of 1997. In this case assume DATE '1997-01-01'

CHAIN OF THOUGHT:
Let's think step by step.
According to "shipped during a given", columns [lineitem.l_shipdate] may be used.
According to "supplier number", columns [supplier.s_phone, supplier.s_suppkey] may be used.
According to "supplier query finds the", columns [supplier.s_address, supplier.s_name] may be used.
Values [1997-01-01, 3] may be used.
So the final answer is:

SQL QUERY:
create view revenue0 (supplier_no, total_revenue) as
	select
		l_suppkey,
		sum(l_extendedprice * (1 - l_discount))
	from
		lineitem
	where
		l_shipdate >= date '1997-01-01'
		and l_shipdate < date '1997-01-01' + interval '3' month
	group by
		l_suppkey;


select
	s_suppkey,
	s_name,
	s_address,
	s_phone,
	total_revenue
from
	supplier,
	revenue0
where
	s_suppkey = supplier_no
	and total_revenue = (
		select
			max(total_revenue)
		from
			revenue0
	)
order by
	s_suppkey;

drop view revenue0;

--- Your Task ---
QUESTION:
The query identifies customers who might be having problems with the parts that are shipped to them.
The Returned Item Reporting Query finds the top 20 customers, in terms of their effect on lost revenue for a given quarter,  who  have  returned  parts.  The  query  considers  only  parts  that  were  ordered  in  the  specified  quarter.  The query lists the customer's name, address, nation, phone number, account balance, comment information and revenue lost. The customers are listed in descending order of lost revenue. Revenue lost is defined as sum(l_extendedprice*(1-l_discount)) for all qualifying lineitems.
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text:
1. DATE is the first day of a randomly selected month from the second month of 1993 to the first month of 1995. In this case assume DATE '1993-08-01'

Think step by step and then return ONLY the SQL query:
