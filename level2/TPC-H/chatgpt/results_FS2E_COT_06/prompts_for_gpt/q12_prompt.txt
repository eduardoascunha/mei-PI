
You are a SQL expert.
The examples below show reasoning patterns and SQL queries.
Follow the same step-by-step thinking approach for the new question.
Return ONLY the SQL code without markdown formatting or explanations.


DATABASE SCHEMA:
Table customer(
  c_custkey integer,
  c_name character varying,
  c_address character varying,
  c_nationkey integer,
  c_phone character,
  c_acctbal numeric,
  c_mktsegment character,  -- Possible values: 'AUTOMOBILE', 'BUILDING', 'FURNITURE', 'MACHINERY', 'HOUSEHOLD'
  c_comment character varying
)

Table lineitem(
  l_orderkey integer,
  l_partkey integer,
  l_suppkey integer,
  l_linenumber integer,
  l_quantity numeric,
  l_extendedprice numeric,
  l_discount numeric,
  l_tax numeric,
  l_returnflag character,  -- Possible values: 'R' (Return), 'A' (Accept), 'N' (No return)
  l_linestatus character,  -- Possible values: 'O' (Open), 'F' (Filled)
  l_shipdate date,
  l_commitdate date,
  l_receiptdate date,
  l_shipinstruct character,  -- Possible values: 'DELIVER IN PERSON', 'COLLECT COD', 'NONE', 'TAKE BACK RETURN'
  l_shipmode character,  -- Possible values: 'AIR REG', 'AIR', 'RAIL', 'SHIP', 'TRUCK', 'MAIL', 'FOB'
  l_comment character varying
)

Table nation(
  n_nationkey integer,
  n_name character,   -- examples: 'ALGERIA', 'BRAZIL', 'CANADA', 'JAPAN', etc.
  n_regionkey integer,
  n_comment character varying
)

Table orders(
  o_orderkey integer,
  o_custkey integer,
  o_orderstatus character,  -- Possible values: 'O' (Open), 'F' (Filled), 'P' (Partial)
  o_totalprice numeric,
  o_orderdate date,
  o_orderpriority character,  -- Possible values: '1-URGENT', '2-HIGH', '3-MEDIUM', '4-NOT SPECIFIED', '5-LOW'
  o_clerk character,
  o_shippriority integer,
  o_comment character varying
)

Table part(
  p_partkey integer,
  p_name character varying,
  p_mfgr character,  
  p_brand character,  
  p_type character varying,  
  p_size integer,
  p_container character, 
  p_retailprice numeric,
  p_comment character varying
)

Table partsupp(
  ps_partkey integer,
  ps_suppkey integer,
  ps_availqty integer,
  ps_supplycost numeric,
  ps_comment character varying
)

Table region(
  r_regionkey integer,
  r_name character,  -- Possible values: 'AFRICA', 'AMERICA', 'ASIA', 'EUROPE', 'MIDDLE EAST'
  r_comment character varying
)

Table supplier(
  s_suppkey integer,
  s_name character varying,
  s_address character varying,
  s_nationkey integer,
  s_phone character,
  s_acctbal numeric,
  s_comment character varying
)

Here are some examples of questions with chain-of-thought reasoning and their SQL queries:

--- Example 1 ---
QUESTION:
This query determines how well the order priority system is working and gives an assessment of customer satisfaction.
The Order Priority Checking Query counts the number of orders ordered in a given quarter of a given year in which at least one lineitem  was received by the  customer later than its committed date. The  query lists the  count of such orders for each order priority sorted in ascending priority order.
Substitution Parameters: Values for the following substitution parameter must be generated and used to build the executable query text: 
1. DATE  is  the  first  day  of  a  randomly  selected  month  between  the  first  month  of  1993  and  the  10th  month  of 1997. In this case assume date '1997-01-01'

CHAIN OF THOUGHT:
Let's think step by step.
According to "lineitem was", columns [lineitem.l_commitdate] may be used.
According to "lineitem was received by", columns [lineitem.l_receiptdate] may be used.
According to "of orders ordered", columns [orders.o_orderdate] may be used.
According to "of orders ordered in", columns [orders.o_orderpriority] may be used.
According to "one lineitem", columns [lineitem.l_orderkey] may be used.
According to "orders ordered in a", columns [orders.o_orderkey] may be used.
Values [1997-01-01, 3] may be used.
So the final answer is:

SQL QUERY:
select
	o_orderpriority,
	count(*) as order_count
from
	orders
where
	o_orderdate >= date '1997-01-01'
	and o_orderdate < date '1997-01-01' + interval '3' month
	and exists (
		select
			*
		from
			lineitem
		where
			l_orderkey = o_orderkey
			and l_commitdate < l_receiptdate
	)
group by
	o_orderpriority
order by
	o_orderpriority;

--- Example 2 ---
QUESTION:
This query determines the value of goods shipped between certain nations to help in the  re-negotiation of shipping 
contracts. 
The Volume  Shipping Query finds, for two given nations, the  gross discounted revenues derived from lineitems in which parts  were  shipped from a  supplier in either nation to a  customer in the  other nation during 1995 and 1996. The query lists the supplier nation, the customer nation, the year, and the revenue from shipments that took place  in that year. The query orders the answer by Supplier nation, Customer nation, and year (all ascending).
Substitution Parameters: Values for the following substitution parameters must be generated and used to build the executable query text: 
1. NATION1 is randomly selected within the list of values defined for N_NAME in Clause 4.2.3; In this case assume NATION1 'ARGENTINA'
2. NATION2 is randomly selected within the list of values defined for N_NAME in Clause 4.2.3 and must be different from the value selected for NATION1 in item 1 above. In this case assume NATION2 'KENYA'

CHAIN OF THOUGHT:
Let's think step by step.
According to "customer nation the", columns [customer.c_custkey] may be used.
According to "derived from lineitems in", columns [lineitem.l_extendedprice] may be used.
According to "from lineitems in", columns [lineitem.l_shipdate] may be used.
According to "lineitems in", columns [lineitem.l_discount, lineitem.l_orderkey, lineitem.l_suppkey] may be used.
According to "nation customer", columns [customer.c_nationkey] may be used.
According to "nation1 in", columns [nation.n_name, nation.n_nationkey] may be used.
According to "query orders", columns [orders.o_custkey, orders.o_orderkey] may be used.
According to "supplier in", columns [supplier.s_suppkey] may be used.
According to "supplier nation", columns [supplier.s_nationkey] may be used.
Values [1995-01-01, 1996-12-31, ARGENTINA, KENYA] may be used.
So the final answer is:

SQL QUERY:
select
	supp_nation,
	cust_nation,
	l_year,
	sum(volume) as revenue
from
	(
		select
			n1.n_name as supp_nation,
			n2.n_name as cust_nation,
			extract(year from l_shipdate) as l_year,
			l_extendedprice * (1 - l_discount) as volume
		from
			supplier,
			lineitem,
			orders,
			customer,
			nation n1,
			nation n2
		where
			s_suppkey = l_suppkey
			and o_orderkey = l_orderkey
			and c_custkey = o_custkey
			and s_nationkey = n1.n_nationkey
			and c_nationkey = n2.n_nationkey
			and (
				(n1.n_name = 'ARGENTINA' and n2.n_name = 'KENYA')
				or (n1.n_name = 'KENYA' and n2.n_name = 'ARGENTINA')
			)
			and l_shipdate between date '1995-01-01' and date '1996-12-31'
	) as shipping
group by
	supp_nation,
	cust_nation,
	l_year
order by
	supp_nation,
	cust_nation,
	l_year;

--- Your Task ---
QUESTION:
This query determines whether selecting less expensive modes of shipping is negatively affecting the critical-priority orders by causing more parts to be received by customers after the committed date.
The Shipping Modes and Order Priority Query counts, by ship mode, for lineitems actually received by customers in 
a given year, the number of lineitems belonging to orders for which the l_receiptdate exceeds the l_commitdate for 
two  different  specified  ship  modes.  Only  lineitems  that  were  actually  shipped  before  the  l_commitdate  are  con-
sidered. The late lineitems are partitioned into two groups, those with priority URGENT or HIGH, and those with a 
priority other than URGENT.
Substitution Parameters: Values for the following substitution parameters must be generated and used to build the executable query text: 
1. SHIPMODE1 is randomly selected within the list of values defined for Modes in Clause 4.2.2.13; In this case assume SHIPMODE1 'FOB'
2. SHIPMODE2 is randomly selected within the list of values defined for Modes in  Clause  4.2.2.13 and must be different from the value selected for SHIPMODE1 in item 1; In this case assume SHIPMODE2 'MAIL'
3. DATE is the first of January of a randomly selected year within [1993 .. 1997]. In this case assume DATE '1996-01-01'

Think step by step and then return ONLY the SQL query:
